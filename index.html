<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Roomscale VR Shooter</title>
<style>
  body { margin: 0; overflow: hidden; background: #000; color: white; }
  #scoreboard {
    position: absolute; top: 10px; left: 10px;
    font-family: monospace; font-size: 20px;
    background: rgba(0,0,0,0.5); padding: 6px 12px;
    border-radius: 5px; z-index: 10;
  }
</style>
</head>
<body>
<div id="scoreboard">Score: 0</div>

<script type="module">
import * as THREE from 'https://cdn.skypack.dev/three';
import { VRButton } from 'https://cdn.skypack.dev/three/examples/jsm/webxr/VRButton.js';

let scene, camera, renderer, controller;
let enemies = [], bullets = [];
let score = 0;
const scoreDisplay = document.getElementById('scoreboard');

init();
animate();

function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x202025);

  camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 100);
  camera.position.set(0, 1.6, 3); // typical eye height

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.xr.enabled = true;
  document.body.appendChild(renderer.domElement);
  document.body.appendChild(VRButton.createButton(renderer));

  // Lighting
  const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444);
  hemiLight.position.set(0, 20, 0);
  scene.add(hemiLight);

  const dirLight = new THREE.DirectionalLight(0xffffff);
  dirLight.position.set(3, 10, 10);
  scene.add(dirLight);

  // Floor (large for walking)
  const floorGeometry = new THREE.PlaneGeometry(20, 20);
  const floorMaterial = new THREE.MeshStandardMaterial({color: 0x222222});
  const floor = new THREE.Mesh(floorGeometry, floorMaterial);
  floor.rotation.x = -Math.PI/2;
  scene.add(floor);

  // Controller
  controller = renderer.xr.getController(0);
  controller.addEventListener('select', shoot);
  scene.add(controller);

  // Enemies - red cubes scattered in the space
  for(let i=0; i<10; i++) {
    const enemy = new THREE.Mesh(
      new THREE.BoxGeometry(0.5, 0.5, 0.5),
      new THREE.MeshStandardMaterial({color: 0xff0000})
    );
    enemy.position.set((Math.random()-0.5)*10, 0.25, (Math.random()-0.5)*10 - 5);
    scene.add(enemy);
    enemies.push(enemy);
  }

  window.addEventListener('resize', onWindowResize, false);
}

function shoot() {
  const bullet = new THREE.Mesh(
    new THREE.SphereGeometry(0.03, 8, 8),
    new THREE.MeshBasicMaterial({color: 0xffff00})
  );

  // Start bullet at controller position
  bullet.position.setFromMatrixPosition(controller.matrixWorld);

  // Shoot forward from controller orientation
  const direction = new THREE.Vector3(0, 0, -1).applyQuaternion(controller.quaternion);
  bullet.userData.velocity = direction.multiplyScalar(0.4);

  scene.add(bullet);
  bullets.push(bullet);
}

function animate() {
  renderer.setAnimationLoop(() => {
    // Move bullets and check collisions
    bullets.forEach((bullet, bIndex) => {
      bullet.position.add(bullet.userData.velocity);

      enemies.forEach((enemy, eIndex) => {
        if(enemy && bullet.position.distanceTo(enemy.position) < 0.5) {
          scene.remove(enemy);
          enemies[eIndex] = null;
          scene.remove(bullet);
          bullets.splice(bIndex, 1);
          score += 10;
          scoreDisplay.textContent = 'Score: ' + score;
        }
      });

      // Remove bullet if out of bounds
      if(Math.abs(bullet.position.x) > 20 || Math.abs(bullet.position.z) > 20) {
        scene.remove(bullet);
        bullets.splice(bIndex, 1);
      }
    });

    renderer.render(scene, camera);
  });
}

function onWindowResize() {
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}
</script>
</body>
</html>

